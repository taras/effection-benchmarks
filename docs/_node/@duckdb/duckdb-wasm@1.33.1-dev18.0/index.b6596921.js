import*as r from"../../apache-arrow@17.0.0/index.5bf8ca6e.js";var v=Object.create,g=Object.defineProperty,G=Object.getOwnPropertyDescriptor,B=Object.getOwnPropertyNames,Q=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,Y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),H=(e,t,s,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of B(t))!q.call(e,i)&&i!==s&&g(e,i,{get:()=>t[i],enumerable:!(a=G(t,i))||a.enumerable});return e},K=(e,t,s)=>(s=e!=null?v(Q(e)):{},H(!e||!e.__esModule?g(s,"default",{value:e,enumerable:!0}):s,e)),W=Y((e,t)=>{t.exports=Worker}),N=(e=>(e[e.UNDEFINED=0]="UNDEFINED",e[e.AUTOMATIC=1]="AUTOMATIC",e[e.READ_ONLY=2]="READ_ONLY",e[e.READ_WRITE=3]="READ_WRITE",e))(N||{}),O=(e=>(e[e.IDENTIFIER=0]="IDENTIFIER",e[e.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",e[e.STRING_CONSTANT=2]="STRING_CONSTANT",e[e.OPERATOR=3]="OPERATOR",e[e.KEYWORD=4]="KEYWORD",e[e.COMMENT=5]="COMMENT",e))(O||{}),y=(e=>(e[e.NONE=0]="NONE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARNING=3]="WARNING",e[e.ERROR=4]="ERROR",e))(y||{}),F=(e=>(e[e.NONE=0]="NONE",e[e.CONNECT=1]="CONNECT",e[e.DISCONNECT=2]="DISCONNECT",e[e.OPEN=3]="OPEN",e[e.QUERY=4]="QUERY",e[e.INSTANTIATE=5]="INSTANTIATE",e))(F||{}),A=(e=>(e[e.NONE=0]="NONE",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR",e[e.START=3]="START",e[e.RUN=4]="RUN",e[e.CAPTURE=5]="CAPTURE",e))(A||{}),m=(e=>(e[e.NONE=0]="NONE",e[e.WEB_WORKER=1]="WEB_WORKER",e[e.NODE_WORKER=2]="NODE_WORKER",e[e.BINDINGS=3]="BINDINGS",e[e.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",e))(m||{}),x=class{log(e){}},V=class{constructor(e=2){this.level=e}log(e){e.level>=this.level&&console.log(e)}};function z(e){switch(e){case 0:return"NONE";case 1:return"DEBUG";case 2:return"INFO";case 3:return"WARNING";case 4:return"ERROR";default:return"?"}}function j(e){switch(e){case 0:return"NONE";case 1:return"OK";case 2:return"ERROR";case 3:return"START";case 4:return"RUN";case 5:return"CAPTURE";default:return"?"}}function J(e){switch(e){case 1:return"CONNECT";case 2:return"DISCONNECT";case 5:return"INSTANTIATE";case 3:return"OPEN";case 4:return"QUERY";default:return"?"}}function X(e){switch(e){case 0:return"NONE";case 1:return"WEB WORKER";case 2:return"NODE WORKER";case 3:return"DUCKDB BINDINGS";case 4:return"DUCKDB";default:return"?"}}var P=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.MAX_ARROW_ERROR=255]="MAX_ARROW_ERROR",e[e.DUCKDB_WASM_RETRY=256]="DUCKDB_WASM_RETRY",e))(P||{});function Z(e){return e<=255}function $(e){return e===256}var L=class{constructor(e,t){this._bindings=e,this._conn=t}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(e){return e(this._bindings,this._conn)}async query(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let t=await this._bindings.runQuery(this._conn,e),s=r.RecordBatchReader.from(t);return console.assert(s.isSync(),"Reader is not sync"),console.assert(s.isFile(),"Reader is not file"),new r.Table(s)}async send(e,t=!1){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let s=await this._bindings.startPendingQuery(this._conn,e,t);for(;s==null;){if(this._bindings.isDetached()){console.error("cannot send a message since the worker is not set!");return}s=await this._bindings.pollPendingQuery(this._conn)}let a=new l(this._bindings,this._conn,s),i=await r.RecordBatchReader.from(a);return console.assert(i.isAsync()),console.assert(i.isStream()),i}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(e){return await this._bindings.getTableNames(this._conn,e)}async prepare(e){let t=await this._bindings.createPrepared(this._conn,e);return new w(this._bindings,this._conn,t)}async insertArrowTable(e,t){let s=r.tableToIPC(e,"stream");await this.insertArrowFromIPCStream(s,t)}async insertArrowFromIPCStream(e,t){await this._bindings.insertArrowFromIPCStream(this._conn,e,t)}async insertCSVFromPath(e,t){await this._bindings.insertCSVFromPath(this._conn,e,t)}async insertJSONFromPath(e,t){await this._bindings.insertJSONFromPath(this._conn,e,t)}},l=class{constructor(e,t,s){this.db=e,this.conn=t,this.header=s,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let e=null;for(this._inFlight!=null&&(e=await this._inFlight,this._inFlight=null);e==null;)e=await this.db.fetchQueryResults(this.conn);return this._depleted=e.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:e}}[Symbol.asyncIterator](){return this}},w=class{constructor(e,t,s){this.bindings=e,this.connectionId=t,this.statementId=s}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...e){let t=await this.bindings.runPrepared(this.connectionId,this.statementId,e),s=r.RecordBatchReader.from(t);return console.assert(s.isSync()),console.assert(s.isFile()),new r.Table(s)}async send(...e){let t=await this.bindings.sendPrepared(this.connectionId,this.statementId,e),s=new l(this.bindings,this.connectionId,t),a=await r.RecordBatchReader.from(s);return console.assert(a.isAsync()),console.assert(a.isStream()),a}},b=(e=>(e.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",e.CLOSE_PREPARED="CLOSE_PREPARED",e.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",e.REGISTER_OPFS_FILE_NAME="REGISTER_OPFS_FILE_NAME",e.CONNECT="CONNECT",e.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",e.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",e.CREATE_PREPARED="CREATE_PREPARED",e.DISCONNECT="DISCONNECT",e.DROP_FILE="DROP_FILE",e.DROP_FILES="DROP_FILES",e.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",e.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",e.FLUSH_FILES="FLUSH_FILES",e.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",e.GET_TABLE_NAMES="GET_TABLE_NAMES",e.GET_VERSION="GET_VERSION",e.GLOB_FILE_INFOS="GLOB_FILE_INFOS",e.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",e.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",e.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",e.INSTANTIATE="INSTANTIATE",e.OPEN="OPEN",e.PING="PING",e.POLL_PENDING_QUERY="POLL_PENDING_QUERY",e.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",e.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",e.REGISTER_FILE_URL="REGISTER_FILE_URL",e.RESET="RESET",e.RUN_PREPARED="RUN_PREPARED",e.RUN_QUERY="RUN_QUERY",e.SEND_PREPARED="SEND_PREPARED",e.START_PENDING_QUERY="START_PENDING_QUERY",e.TOKENIZE="TOKENIZE",e))(b||{}),C=(e=>(e.CONNECTION_INFO="CONNECTION_INFO",e.ERROR="ERROR",e.FEATURE_FLAGS="FEATURE_FLAGS",e.FILE_BUFFER="FILE_BUFFER",e.FILE_INFOS="FILE_INFOS",e.FILE_SIZE="FILE_SIZE",e.FILE_STATISTICS="FILE_STATISTICS",e.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",e.LOG="LOG",e.PROGRESS_UPDATE="PROGRESS_UPDATE",e.OK="OK",e.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",e.QUERY_PLAN="QUERY_PLAN",e.QUERY_RESULT="QUERY_RESULT",e.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",e.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",e.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",e.REGISTERED_FILE="REGISTERED_FILE",e.SCRIPT_TOKENS="SCRIPT_TOKENS",e.SUCCESS="SUCCESS",e.TABLE_NAMES="TABLE_NAMES",e.VERSION_STRING="VERSION_STRING",e))(C||{}),n=class{constructor(e,t){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=e,this.data=t,this.promise=new Promise((s,a)=>{this.promiseResolver=s,this.promiseRejecter=a})}};function E(e){switch(e.typeId){case r.Type.Binary:return{sqlType:"binary"};case r.Type.Bool:return{sqlType:"bool"};case r.Type.Date:return{sqlType:"date"};case r.Type.DateDay:return{sqlType:"date32[d]"};case r.Type.DateMillisecond:return{sqlType:"date64[ms]"};case r.Type.Decimal:{let t=e;return{sqlType:"decimal",precision:t.precision,scale:t.scale}}case r.Type.Float:return{sqlType:"float"};case r.Type.Float16:return{sqlType:"float16"};case r.Type.Float32:return{sqlType:"float32"};case r.Type.Float64:return{sqlType:"float64"};case r.Type.Int:return{sqlType:"int32"};case r.Type.Int16:return{sqlType:"int16"};case r.Type.Int32:return{sqlType:"int32"};case r.Type.Int64:return{sqlType:"int64"};case r.Type.Uint16:return{sqlType:"uint16"};case r.Type.Uint32:return{sqlType:"uint32"};case r.Type.Uint64:return{sqlType:"uint64"};case r.Type.Uint8:return{sqlType:"uint8"};case r.Type.IntervalDayTime:return{sqlType:"interval[dt]"};case r.Type.IntervalYearMonth:return{sqlType:"interval[m]"};case r.Type.List:return{sqlType:"list",valueType:E(e.valueType)};case r.Type.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:e.byteWidth};case r.Type.Null:return{sqlType:"null"};case r.Type.Utf8:return{sqlType:"utf8"};case r.Type.Struct:return{sqlType:"struct",fields:e.children.map(t=>d(t.name,t.type))};case r.Type.Map:{let t=e;return{sqlType:"map",keyType:E(t.keyType),valueType:E(t.valueType)}}case r.Type.Time:return{sqlType:"time[s]"};case r.Type.TimeMicrosecond:return{sqlType:"time[us]"};case r.Type.TimeMillisecond:return{sqlType:"time[ms]"};case r.Type.TimeNanosecond:return{sqlType:"time[ns]"};case r.Type.TimeSecond:return{sqlType:"time[s]"};case r.Type.Timestamp:return{sqlType:"timestamp",timezone:e.timezone||void 0};case r.Type.TimestampSecond:return{sqlType:"timestamp[s]",timezone:e.timezone||void 0};case r.Type.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:e.timezone||void 0};case r.Type.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:e.timezone||void 0};case r.Type.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:e.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(e.toString()))}function d(e,t){let s=E(t);return s.name=e,s}var ee=/'(opfs:\/\/\S*?)'/g,te=/(opfs:\/\/\S*?)/g;function se(e){return e.search(te)>-1}function ae(e){return[...e.matchAll(ee)].map(t=>t[1])}var re=new TextEncoder,ne=class{constructor(e,t=null){this._onInstantiationProgress=[],this._onExecutionProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._config={},this._logger=e,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),t!=null&&this.attach(t)}get logger(){return this._logger}get config(){return this._config}attach(e){this._worker=e,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((t,s)=>{this._workerShutdownResolver=t})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(e,t=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!:"+e.type+","+e.data);return}let s=this._nextMessageId++;return this._pendingRequests.set(s,e),this._worker.postMessage({messageId:s,type:e.type,data:e.data},t),await e.promise}onMessage(e){var t;let s=e.data;switch(s.type){case"PROGRESS_UPDATE":{for(let i of this._onExecutionProgress)i(s.data);return}case"LOG":{this._logger.log(s.data);return}case"INSTANTIATE_PROGRESS":{for(let i of this._onInstantiationProgress)i(s.data);return}}let a=this._pendingRequests.get(s.requestId);if(!a){console.warn("unassociated response: [".concat(s.requestId,", ").concat(s.type.toString(),"]"));return}if(this._pendingRequests.delete(s.requestId),s.type=="ERROR"){let i=new Error(s.data.message);i.name=s.data.name,(t=Object.getOwnPropertyDescriptor(i,"stack"))!=null&&t.writable&&(i.stack=s.data.stack),a.promiseRejecter(i);return}switch(a.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"REGISTER_OPFS_FILE_NAME":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(s.type=="OK"){a.promiseResolver(s.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],s.type=="OK"){a.promiseResolver(s.data);return}break;case"GLOB_FILE_INFOS":if(s.type=="FILE_INFOS"){a.promiseResolver(s.data);return}break;case"GET_VERSION":if(s.type=="VERSION_STRING"){a.promiseResolver(s.data);return}break;case"GET_FEATURE_FLAGS":if(s.type=="FEATURE_FLAGS"){a.promiseResolver(s.data);return}break;case"GET_TABLE_NAMES":if(s.type=="TABLE_NAMES"){a.promiseResolver(s.data);return}break;case"TOKENIZE":if(s.type=="SCRIPT_TOKENS"){a.promiseResolver(s.data);return}break;case"COPY_FILE_TO_BUFFER":if(s.type=="FILE_BUFFER"){a.promiseResolver(s.data);return}break;case"EXPORT_FILE_STATISTICS":if(s.type=="FILE_STATISTICS"){a.promiseResolver(s.data);return}break;case"CONNECT":if(s.type=="CONNECTION_INFO"){a.promiseResolver(s.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(s.type=="QUERY_RESULT"){a.promiseResolver(s.data);return}break;case"SEND_PREPARED":if(s.type=="QUERY_RESULT_HEADER"){a.promiseResolver(s.data);return}break;case"START_PENDING_QUERY":if(s.type=="QUERY_RESULT_HEADER_OR_NULL"){a.promiseResolver(s.data);return}break;case"POLL_PENDING_QUERY":if(s.type=="QUERY_RESULT_HEADER_OR_NULL"){a.promiseResolver(s.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],s.type=="SUCCESS"){a.promiseResolver(s.data);return}break;case"FETCH_QUERY_RESULTS":if(s.type=="QUERY_RESULT_CHUNK"){a.promiseResolver(s.data);return}break;case"CREATE_PREPARED":if(s.type=="PREPARED_STATEMENT_ID"){a.promiseResolver(s.data);return}break}a.promiseRejecter(new Error("unexpected response type: ".concat(s.type.toString())))}onError(e){console.error(e),console.error("error in duckdb worker: ".concat(e.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}isDetached(){return!this._worker}async reset(){let e=new n("RESET",null);return await this.postTask(e)}async ping(){let e=new n("PING",null);await this.postTask(e)}async dropFile(e){let t=new n("DROP_FILE",e);return await this.postTask(t)}async dropFiles(e){let t=new n("DROP_FILES",e);return await this.postTask(t)}async flushFiles(){let e=new n("FLUSH_FILES",null);return await this.postTask(e)}async instantiate(e,t=null,s=a=>{}){this._onInstantiationProgress.push(s);let a=new n("INSTANTIATE",[e,t]);return await this.postTask(a)}async getVersion(){let e=new n("GET_VERSION",null);return await this.postTask(e)}async getFeatureFlags(){let e=new n("GET_FEATURE_FLAGS",null);return await this.postTask(e)}async open(e){this._config=e;let t=new n("OPEN",e);await this.postTask(t)}async tokenize(e){let t=new n("TOKENIZE",e);return await this.postTask(t)}async connectInternal(){let e=new n("CONNECT",null);return await this.postTask(e)}async connect(){let e=await this.connectInternal();return new L(this,e)}async disconnect(e){let t=new n("DISCONNECT",e);await this.postTask(t)}async runQuery(e,t){if(this.shouldOPFSFileHandling()){let s=await this.registerOPFSFileFromSQL(t);try{return await this._runQueryAsync(e,t)}finally{s.length>0&&await this.dropFiles(s)}}else return await this._runQueryAsync(e,t)}async _runQueryAsync(e,t){let s=new n("RUN_QUERY",[e,t]);return await this.postTask(s)}async startPendingQuery(e,t,s=!1){if(this.shouldOPFSFileHandling()){let a=await this.registerOPFSFileFromSQL(t);try{return await this._startPendingQueryAsync(e,t,s)}finally{a.length>0&&await this.dropFiles(a)}}else return await this._startPendingQueryAsync(e,t,s)}async _startPendingQueryAsync(e,t,s=!1){let a=new n("START_PENDING_QUERY",[e,t,s]);return await this.postTask(a)}async pollPendingQuery(e){let t=new n("POLL_PENDING_QUERY",e);return await this.postTask(t)}async cancelPendingQuery(e){let t=new n("CANCEL_PENDING_QUERY",e);return await this.postTask(t)}async fetchQueryResults(e){let t=new n("FETCH_QUERY_RESULTS",e);return await this.postTask(t)}async getTableNames(e,t){let s=new n("GET_TABLE_NAMES",[e,t]);return await this.postTask(s)}async createPrepared(e,t){let s=new n("CREATE_PREPARED",[e,t]);return await this.postTask(s)}async closePrepared(e,t){let s=new n("CLOSE_PREPARED",[e,t]);await this.postTask(s)}async runPrepared(e,t,s){let a=new n("RUN_PREPARED",[e,t,s]);return await this.postTask(a)}async sendPrepared(e,t,s){let a=new n("SEND_PREPARED",[e,t,s]);return await this.postTask(a)}async globFiles(e){let t=new n("GLOB_FILE_INFOS",e);return await this.postTask(t)}async registerFileText(e,t){let s=re.encode(t);await this.registerFileBuffer(e,s)}async registerFileURL(e,t,s,a){t===void 0&&(t=e);let i=new n("REGISTER_FILE_URL",[e,t,s,a]);await this.postTask(i)}async registerEmptyFileBuffer(e){}async registerFileBuffer(e,t){let s=new n("REGISTER_FILE_BUFFER",[e,t]);await this.postTask(s,[t.buffer])}async registerFileHandle(e,t,s,a){let i=new n("REGISTER_FILE_HANDLE",[e,t,s,a]);await this.postTask(i,[])}async registerOPFSFileName(e){let t=new n("REGISTER_OPFS_FILE_NAME",[e]);await this.postTask(t,[])}async collectFileStatistics(e,t){let s=new n("COLLECT_FILE_STATISTICS",[e,t]);await this.postTask(s,[])}async exportFileStatistics(e){let t=new n("EXPORT_FILE_STATISTICS",e);return await this.postTask(t,[])}async copyFileToBuffer(e){let t=new n("COPY_FILE_TO_BUFFER",e);return await this.postTask(t)}async copyFileToPath(e,t){let s=new n("COPY_FILE_TO_PATH",[e,t]);await this.postTask(s)}async insertArrowFromIPCStream(e,t,s){if(t.length==0)return;let a=new n("INSERT_ARROW_FROM_IPC_STREAM",[e,t,s]);await this.postTask(a,[t.buffer])}async insertCSVFromPath(e,t,s){if(s.columns!==void 0){let i=[];for(let o in s.columns){let _=s.columns[o];i.push(d(o,_))}s.columnsFlat=i,delete s.columns}let a=new n("IMPORT_CSV_FROM_PATH",[e,t,s]);await this.postTask(a)}async insertJSONFromPath(e,t,s){if(s.columns!==void 0){let i=[];for(let o in s.columns){let _=s.columns[o];i.push(d(o,_))}s.columnsFlat=i,delete s.columns}let a=new n("IMPORT_JSON_FROM_PATH",[e,t,s]);await this.postTask(a)}shouldOPFSFileHandling(){var e,t;return se((e=this.config.path)!=null?e:"")?((t=this.config.opfs)==null?void 0:t.fileHandling)=="auto":!1}async registerOPFSFileFromSQL(e){let t=ae(e),s=[];for(let a of t)try{await this.registerOPFSFileName(a),s.push(a)}catch(i){throw console.error(i),new Error("File Not found:"+a)}return s}};function ie(){let e=new TextDecoder;return t=>(typeof SharedArrayBuffer<"u"&&t.buffer instanceof SharedArrayBuffer&&(t=new Uint8Array(t)),e.decode(t))}ie();var f=(e=>(e[e.BUFFER=0]="BUFFER",e[e.NODE_FS=1]="NODE_FS",e[e.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",e[e.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",e[e.HTTP=4]="HTTP",e[e.S3=5]="S3",e))(f||{}),oe=class{constructor(){this._bindings=null,this._nextMessageId=0}log(e){this.postMessage({messageId:this._nextMessageId++,requestId:0,type:"LOG",data:e},[])}sendOK(e){this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"OK",data:null},[])}failWith(e,t){let s={name:t.name,message:t.message,stack:t.stack||void 0};this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"ERROR",data:s},[])}async onMessage(e){switch(e.type){case"PING":this.sendOK(e);return;case"INSTANTIATE":this._bindings!=null&&this.failWith(e,new Error("duckdb already initialized"));try{this._bindings=await this.instantiate(e.data[0],e.data[1],t=>{this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"INSTANTIATE_PROGRESS",data:t},[])}),this.sendOK(e)}catch(t){console.log(t),this._bindings=null,this.failWith(e,t)}return}if(!this._bindings)return this.failWith(e,new Error("duckdb is not initialized"));try{switch(e.type){case"GET_VERSION":this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"VERSION_STRING",data:this._bindings.getVersion()},[]);break;case"GET_FEATURE_FLAGS":this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"FEATURE_FLAGS",data:this._bindings.getFeatureFlags()},[]);break;case"RESET":this._bindings.reset(),this.sendOK(e);break;case"OPEN":{let t=e.data.path;t!=null&&t.startsWith("opfs://")&&(await this._bindings.prepareDBFileHandle(t,3),e.data.useDirectIO=!0),this._bindings.open(e.data),this.sendOK(e);break}case"DROP_FILE":this._bindings.dropFile(e.data),this.sendOK(e);break;case"DROP_FILES":this._bindings.dropFiles(e.data),this.sendOK(e);break;case"FLUSH_FILES":this._bindings.flushFiles(),this.sendOK(e);break;case"CONNECT":{let t=this._bindings.connect();this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"CONNECTION_INFO",data:t.useUnsafe((s,a)=>a)},[]);break}case"DISCONNECT":this._bindings.disconnect(e.data),this.sendOK(e);break;case"CREATE_PREPARED":{let t=this._bindings.createPrepared(e.data[0],e.data[1]);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"PREPARED_STATEMENT_ID",data:t},[]);break}case"CLOSE_PREPARED":{this._bindings.closePrepared(e.data[0],e.data[1]),this.sendOK(e);break}case"RUN_PREPARED":{let t=this._bindings.runPrepared(e.data[0],e.data[1],e.data[2]);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT",data:t},[t.buffer]);break}case"RUN_QUERY":{let t=this._bindings.runQuery(e.data[0],e.data[1]);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT",data:t},[t.buffer]);break}case"SEND_PREPARED":{let t=this._bindings.sendPrepared(e.data[0],e.data[1],e.data[2]);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT_HEADER",data:t},[t.buffer]);break}case"START_PENDING_QUERY":{let t=this._bindings.startPendingQuery(e.data[0],e.data[1],e.data[2]),s=[];t&&s.push(t.buffer),this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT_HEADER_OR_NULL",data:t},s);break}case"POLL_PENDING_QUERY":{let t=this._bindings.pollPendingQuery(e.data),s=[];t&&s.push(t.buffer),this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT_HEADER_OR_NULL",data:t},s);break}case"CANCEL_PENDING_QUERY":{let t=this._bindings.cancelPendingQuery(e.data);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"SUCCESS",data:t},[]);break}case"FETCH_QUERY_RESULTS":{let t=this._bindings.fetchQueryResults(e.data),s=t?[t.buffer]:[];this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT_CHUNK",data:t},s);break}case"GET_TABLE_NAMES":{let t=this._bindings.getTableNames(e.data[0],e.data[1]);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"TABLE_NAMES",data:t},[]);break}case"GLOB_FILE_INFOS":{let t=this._bindings.globFiles(e.data);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"FILE_INFOS",data:t},[]);break}case"REGISTER_FILE_URL":this._bindings.registerFileURL(e.data[0],e.data[1],e.data[2],e.data[3]),this.sendOK(e);break;case"REGISTER_FILE_BUFFER":this._bindings.registerFileBuffer(e.data[0],e.data[1]),this.sendOK(e);break;case"REGISTER_FILE_HANDLE":await this._bindings.registerFileHandleAsync(e.data[0],e.data[1],e.data[2],e.data[3]),this.sendOK(e);break;case"COPY_FILE_TO_PATH":this._bindings.copyFileToPath(e.data[0],e.data[1]),this.sendOK(e);break;case"COPY_FILE_TO_BUFFER":{let t=this._bindings.copyFileToBuffer(e.data);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"FILE_BUFFER",data:t},[]);break}case"COLLECT_FILE_STATISTICS":this._bindings.collectFileStatistics(e.data[0],e.data[1]),this.sendOK(e);break;case"REGISTER_OPFS_FILE_NAME":await this._bindings.registerOPFSFileName(e.data[0]),this.sendOK(e);break;case"EXPORT_FILE_STATISTICS":{this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"FILE_STATISTICS",data:this._bindings.exportFileStatistics(e.data)},[]);break}case"INSERT_ARROW_FROM_IPC_STREAM":{this._bindings.insertArrowFromIPCStream(e.data[0],e.data[1],e.data[2]),this.sendOK(e);break}case"IMPORT_CSV_FROM_PATH":{this._bindings.insertCSVFromPath(e.data[0],e.data[1],e.data[2]),this.sendOK(e);break}case"IMPORT_JSON_FROM_PATH":{this._bindings.insertJSONFromPath(e.data[0],e.data[1],e.data[2]),this.sendOK(e);break}case"TOKENIZE":{let t=this._bindings.tokenize(e.data);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"SCRIPT_TOKENS",data:t},[]);break}}}catch(t){return console.log(t),this.failWith(e,t)}}},Ee=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),_e=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),le=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),de=()=>(async e=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(e)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),R={name:"@duckdb/duckdb-wasm",version:"1.33.1-dev18.0"},U=R.name,k=R.version,T=R.version.split("."),Re=T[0],Te=T[1],ce=T[2],c=()=>typeof navigator>"u",D=()=>c()?"node":navigator.userAgent,ue=()=>D().includes("Firefox"),Ie=()=>/^((?!chrome|android).)*safari/i.test(D());function he(){let e="https://cdn.jsdelivr.net/npm/".concat(U,"@").concat(k,"/dist/");return{mvp:{mainModule:"".concat(e,"duckdb-mvp.wasm"),mainWorker:"".concat(e,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(e,"duckdb-eh.wasm"),mainWorker:"".concat(e,"duckdb-browser-eh.worker.js")}}}var u=null,I=null,h=null,S=null,p=null;async function M(){return u==null&&(u=typeof BigInt64Array<"u"),I==null&&(I=await _e()),h==null&&(h=await de()),S==null&&(S=await le()),p==null&&(p=await Ee()),{bigInt64Array:u,crossOriginIsolated:c()||globalThis.crossOriginIsolated||!1,wasmExceptions:I,wasmSIMD:S,wasmThreads:h,wasmBulkMemory:p}}async function Se(e){let t=await M();if(t.wasmExceptions){if(t.wasmSIMD&&t.wasmThreads&&t.crossOriginIsolated&&e.coi)return{mainModule:e.coi.mainModule,mainWorker:e.coi.mainWorker,pthreadWorker:e.coi.pthreadWorker};if(e.eh)return{mainModule:e.eh.mainModule,mainWorker:e.eh.mainWorker,pthreadWorker:null}}return{mainModule:e.mvp.mainModule,mainWorker:e.mvp.mainWorker,pthreadWorker:null}}var pe=K(W());async function ge(e){let t=new Request(e),s=await fetch(t),a=URL.createObjectURL(await s.blob());return new pe.default(a)}export{ne as AsyncDuckDB,L as AsyncDuckDBConnection,oe as AsyncDuckDBDispatcher,w as AsyncPreparedStatement,l as AsyncResultStreamIterator,V as ConsoleLogger,N as DuckDBAccessMode,f as DuckDBDataProtocol,Z as IsArrowBuffer,$ as IsDuckDBWasmRetry,A as LogEvent,y as LogLevel,m as LogOrigin,F as LogTopic,U as PACKAGE_NAME,k as PACKAGE_VERSION,Re as PACKAGE_VERSION_MAJOR,Te as PACKAGE_VERSION_MINOR,ce as PACKAGE_VERSION_PATCH,P as StatusCode,O as TokenType,x as VoidLogger,b as WorkerRequestType,C as WorkerResponseType,n as WorkerTask,ge as createWorker,he as getJsDelivrBundles,j as getLogEventLabel,z as getLogLevelLabel,X as getLogOriginLabel,J as getLogTopicLabel,M as getPlatformFeatures,ue as isFirefox,c as isNode,Ie as isSafari,Se as selectBundle};
